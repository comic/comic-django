{% extends "base.html" %}
{% load crispy_forms_tags %}
{% load url %}
{% load get_obj_perms from guardian_tags %}
{% load bleach %}

{% block title %}
    Try-out Algorithm - {{ block.super }}
{% endblock %}

{% block breadcrumbs %}
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a
                href="{% url 'algorithms:list' %}">Algorithms</a>
        </li>
        <li class="breadcrumb-item"><a
                href="{{ algorithm.get_absolute_url }}">{{ algorithm.title }}
        </a>
        <li class="breadcrumb-item active"
            aria-current="page">Create Experiment
        </li>
    </ol>
{% endblock %}

{% block content %}
    {% get_obj_perms request.user for algorithm as "algorithm_perms" %}
    <h2>Try-out Algorithm</h2>

    {{ algorithm.job_create_page_markdown|md2html }}

    {% if "change_algorithm" in algorithm_perms %}
        <p>
                As an admin for this algorithm you can start as many jobs as
                you like. Algorithm users will be allowed to start a maximum of
                {{ max_jobs }} job{{ max_jobs|pluralize }} per month (taking all algorithms into account).
                With the algorithm's job weight you can change this maximum number.
                You can change the job weight in<a href="{% url 'algorithms:update' slug=algorithm.slug %}">
                Settings</a>.
            </p>
        {% crispy form %}
    {% else %}
        {% if remaining_jobs < 0 %}
            <p>
            You have reached your algorithm jobs limit. You can make
                    another submission on {{ next_job_at }}.
            </p>
        {% else %}
            <p>Select the images that you would like to run the algorithm on.</p>
            <p>
                You can upload {{ remaining_jobs }} more
                image{{ remaining_jobs|pluralize }} to try this algorithm.
            </p>

            {% crispy form %}
        {%  endif %}
    <p>
        By running this algorithm you agree to the
        <a href="{% url 'policies:detail' slug='terms-of-service' %}"> General
            Terms of Service</a>{% if algorithm.additional_terms_markdown %},
        as well as this algorithm's specific Terms of Service:
        {% else %}.
        {% endif %}
    {% endif %}
    </p>

    {{ algorithm.additional_terms_markdown|md2html }}

{% endblock %}
